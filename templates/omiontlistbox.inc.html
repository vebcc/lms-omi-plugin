<!--// $Id$ //-->
{$xajax}

<style>
    .status-color-general {
        font-weight: bold;
    }

    .signal-color-general {
        font-weight: bold;
    }

    .status-color-level-0, .status-color-level-10 {
        color: #17a2b8 !important;
    }

    .status-color-level-1, .status-color-level-12 {
        color: #004b00 !important;
    }

    .status-color-level-2 {
        color: #ffc107 !important;
    }

    .status-color-level-3, .status-color-level-11 {
        color: #dc3545 !important;
    }

    .status-color-level-4 {
        color: #dc3545 !important;
    }

    .lms-modal-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.5);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 9999;
    }

    .lms-modal {
        background: #fff;
        border-radius: 8px;
        max-width: 400px;
        width: 100%;
        padding: 20px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        font-family: sans-serif;
    }

    .lms-modal-header {
        font-size: 18px;
        font-weight: bold;
        margin-bottom: 12px;
    }

    .lms-modal-body {
        margin-bottom: 20px;
        font-size: 14px;
        color: #333;
    }

    .lms-modal-actions {
        display: flex;
        justify-content: flex-end;
        gap: 10px;
    }

    .lms-btn {
        padding: 6px 14px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
    }

    .lms-btn-confirm {
        background: #2d8a34;
        color: white;
    }

    .lms-btn-cancel {
        background: #ccc;
        color: black;
    }


</style>

<div id="omionus" data-label="Lista onu klienta" class="lms-ui-tab-container lms-ui-sortable general-omi-text">

    <div class="lms-ui-tab-header lmsbox-titlebar" data-lmsbox-content="omi-onu-panel-nodeinfo">

        <div class="lms-ui-tab-header-cell">
            <img SRC="img/LMSOmiPlugin/olt_manager.ico" alt="" class="lms-ui-sortable-handle"
                 style="max-height: 20px; max-width: auto;">
            <strong>{trans($omioltmanagersectiontitle)} (<span class="onu-counter-span">0</span>):</strong>


        </div>
    </div>

    <div class="lms-ui-tab-contents lms-ui-multi-check assignmentpanel" id="omi-onu-panel-nodeinfo" style="">

        <div class="lms-ui-tab-table" id="super-omi-table">

            <div class="lms-ui-tab-table-row header">
                <div class="lms-ui-tab-table-wrapper col-5">
                    <div class="lms-ui-tab-table-wrapper col-2">
                        <div class="lms-ui-tab-table-column name">
                            <strong>ID:</strong>
                            <br> Adres: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                        </div>
                        <div class="lms-ui-tab-table-column description">
                            MAC:<br>Serial:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                        </div>
                    </div>
                    <div class="lms-ui-tab-table-column id">
                        Model:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    </div>
                    <div class="lms-ui-tab-table-wrapper col-2">
                        <div class="lms-ui-tab-table-column id">
                            Fizyczny status:
                            <br>
                            Status połączenia:
                        </div>
                        <div class="lms-ui-tab-table-column id">
                            Sygnał ONU:
                            <br>
                            Sygnał OLT:
                        </div>
                    </div>
                    <div class="lms-ui-tab-table-column id">
                        Funkcje:
                    </div>
                </div>

                <!-- <div class="lms-ui-tab-table-column buttons">
                     &nbsp;
                 </div>-->
            </div>

        </div>

    </div>
    <div class="lms-modal-overlay" id="lmsConfirmModal">
        <div class="lms-modal">
            <div class="lms-modal-header">Potwierdzenie</div>
            <div class="lms-modal-body" id="lmsConfirmMessage"></div>
            <div class="lms-modal-actions">
                <button class="lms-btn lms-btn-cancel" id="lmsConfirmCancel">Anuluj</button>
                <button class="lms-btn lms-btn-confirm" id="lmsConfirmOk">OK</button>
            </div>
        </div>
    </div>

    <!-- Modal informacji -->
    <div class="lms-modal-overlay" id="lmsInfoModal">
        <div class="lms-modal">
            <div class="lms-modal-header" id="lmsInfoHeader">Informacja</div>
            <div class="lms-modal-body" id="lmsInfoMessage"></div>
            <div class="lms-modal-actions">
                <button class="lms-btn lms-btn-confirm" id="lmsInfoOk">OK</button>
            </div>
        </div>
    </div>
    <script>
        if (getCookie("omi-onu-panel-nodeinfo") == "1") {
            $("#omi-onu-panel-nodeinfo").show();
        }
    </script>
</div>

<script type="text/javascript">
    <!--
    let searchParams = new URLSearchParams(window.location.search);

    let $omiUrlId = null;

    if (searchParams.has('id')) {
        $omiUrlId = searchParams.get('id');
    }

    let $omiOMToken = '{$omioltmanagertoken}';
    let $omiOMUrl = '{$omioltmanagerurl}';
    let $ominewTab = '{$omioltmanagernewtab}';
    let $omiParams = '{$omioltmanagerparams}';
    let $omiSection = '{$omioltmanagersection}';
    let $omiSectionTitle = '{$omioltmanagersectiontitle}';
    let $omiOnuLinkParams = '{$omioltmanageronulinkparams}';
    //-->

</script>

{include file="omiontlistboxjs.html"}

<script type="text/javascript">
    (function ($) {
        $(document).ready(function () {
            if ($omiUrlId && $omiOMToken && $omiOMUrl) {
                switch ($omiSection) {
                    case 'customer':
                        getOnuCollectionByCustomerId($omiUrlId, $omiOMToken, $omiOMUrl);
                        break;
                    case 'device':
                        getOnuCollectionByDeviceId($omiUrlId, $omiOMToken, $omiOMUrl);
                        break;
                    case 'networkdevice':
                        getOnuCollectionByNetworkDeviceId($omiUrlId, $omiOMToken, $omiOMUrl);
                        break;
                    default:
                        console.log('Unknown section: ' + $omiSection);
                }

                function showConfirm(message, onConfirm) {
                    const overlay = document.getElementById("lmsConfirmModal");
                    const msgBox = document.getElementById("lmsConfirmMessage");
                    const btnOk = document.getElementById("lmsConfirmOk");
                    const btnCancel = document.getElementById("lmsConfirmCancel");

                    msgBox.textContent = message;
                    overlay.style.display = "flex";

                    function cleanup() {
                        overlay.style.display = "none";
                        btnOk.removeEventListener("click", okHandler);
                        btnCancel.removeEventListener("click", cancelHandler);
                    }

                    function okHandler() {
                        cleanup();
                        onConfirm();
                    }

                    function cancelHandler() {
                        cleanup();
                    }

                    btnOk.addEventListener("click", okHandler);
                    btnCancel.addEventListener("click", cancelHandler);
                }

                function showInfo(title, message) {
                    const overlay = document.getElementById("lmsInfoModal");
                    const msgBox = document.getElementById("lmsInfoMessage");
                    const header = document.getElementById("lmsInfoHeader");
                    const btnOk = document.getElementById("lmsInfoOk");

                    header.textContent = title;
                    msgBox.textContent = message;
                    overlay.style.display = "flex";

                    function cleanup() {
                        overlay.style.display = "none";
                        btnOk.removeEventListener("click", okHandler);
                    }

                    function okHandler() {
                        cleanup();
                    }

                    btnOk.addEventListener("click", okHandler);
                }

                // delegacja zdarzeń żeby działało dla nowych elementów
                $(document).on('click', '.onu-func-btn', function (e) {
                    e.preventDefault();
                    let url = $(this).data('url');
                    let name = $(this).data('name');

                    showConfirm(`Czy na pewno chcesz uruchomić funkcję: ` + name + `?`, () => {
                        fetch(url, {
                            method: 'GET',
                            headers: {
                                'Content-Type': 'application/json',
                                'X-AUTH-TOKEN': $omiOMToken
                            }
                        })
                            .then(resp => resp.json())
                            .then(data => {
                                if (data.result === "success") {
                                    showInfo("Sukces", `Funkcja "` + name + `" wykonana poprawnie ✅`);
                                } else {
                                    showInfo("Błąd", `Błąd przy wykonywaniu "` + name + `" ❌`);
                                }
                            })
                            .catch(err => {
                                showInfo("Błąd sieci", String(err));
                            });
                    });
                });


            }
        });
    })(jQuery);
</script>